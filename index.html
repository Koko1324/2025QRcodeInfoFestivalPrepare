<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 출석 현황</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-default.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/odometer.min.js"></script>

    <style>
        html, body { height: 100%; margin: 0; overflow: hidden; }
        body { font-family: sans-serif; display: flex; flex-direction: column; background-color: #f0f2f5; }
        .header { text-align: center; padding: 15px 20px; background-color: white; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 10; flex-shrink: 0; }
        h1 { margin: 0; color: #333; font-size: 1.5em; }
        .odometer { font-size: 2.5em; font-weight: bold; color: #007bff; margin-top: 5px; }
        .sprout-container {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(30px, 1fr));
            gap: 8px;
            padding: 20px;
        }
        .sprout-wrapper { width: 100%; aspect-ratio: 1 / 1; color: #e0e0e0; transition: color 0.3s ease; }
        .sprout-svg { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="header">
        <h1>총 출석 현황</h1>
        <p id="total-count" class="odometer">0</p>
    </div>

    <div class="sprout-container" id="sprout-container"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // --- 기존 JavaScript 코드는 그대로 둡니다 ---
        const firebaseConfig = {
            apiKey: "AIzaSyCoHQY_1Gk06eRD8KizPo_e_25RX26vr4M",
            authDomain: "infoqrpeople.firebaseapp.com",
            projectId: "infoqrpeople",
            storageBucket: "infoqrpeople.appspot.com",
            messagingSenderId: "449767938743",
            appId: "1:449767938743:web:9420b3915473864bcd8b32",
            measurementId: "G-0F44C7E2LB"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const colorPalette = {
            1: "rgb(0,0,0)", 2: "rgb(0,0,28)", /* ... */ 1500: "rgb(255,252,252)"
        };

        const totalCountElement = document.getElementById('total-count');
        const sproutContainer = document.getElementById('sprout-container');
        const sprouts = [];
        const sproutSVGCode = `<svg xmlns="http://www.w3.org/2000/svg" class="sprout-svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 10a6 6 0 0 0 -6 -6h-3v2a6 6 0 0 0 6 6h3" /><path d="M12 14a6 6 0 0 1 6 -6h3v2a6 6 0 0 1 -6 6h-3" /><path d="M12 20l0 -10" /></svg>`;

        const od = new Odometer({ el: totalCountElement, value: 0, format: 'd', duration: 500 });

        for (let i = 0; i < 1500; i++) {
            const sproutWrapper = document.createElement('div');
            sproutWrapper.classList.add('sprout-wrapper');
            sproutWrapper.innerHTML = sproutSVGCode;
            sproutContainer.appendChild(sproutWrapper);
            sprouts.push(sproutWrapper);
        }

        db.collection('attendance').doc('total')
            .onSnapshot((doc) => {
                if (doc.exists) { od.update(doc.data().count); }
                else { od.update(0); }
            });

        db.collection('attendance').doc('scanned_ids')
            .onSnapshot((doc) => {
                sprouts.forEach(sprout => { sprout.style.color = '#e0e0e0'; });
                if (doc.exists) {
                    const scannedIds = Object.keys(doc.data());
                    scannedIds.forEach(id => {
                        const sproutIndex = parseInt(id) - 1;
                        if (sproutIndex >= 0 && sproutIndex < sprouts.length) {
                            const color = colorPalette[id] || '#000000';
                            sprouts[sproutIndex].style.color = color;
                        }
                    });
                }
            });

        // ⭐ --- 자동 스크롤 기능 (새로 추가된 부분) --- ⭐

        let scrollInterval;
        let scrollDirection = 1; // 1은 아래로, -1은 위로
        const scrollSpeed = 8; // 스크롤 속도 (숫자가 작을수록 빠름)

        function startScrolling() {
            // 이미 스크롤이 진행 중이면 중복 실행 방지
            if (scrollInterval) return;

            scrollInterval = setInterval(() => {
                // 맨 아래에 도달했는지 체크
                if (sproutContainer.scrollTop + sproutContainer.clientHeight >= sproutContainer.scrollHeight - 1) {
                    scrollDirection = -1; // 방향을 위로 전환
                }
                // 맨 위에 도달했는지 체크
                else if (sproutContainer.scrollTop <= 0) {
                    scrollDirection = 1; // 방향을 아래로 전환
                }
                
                sproutContainer.scrollTop += scrollDirection;
            }, scrollSpeed);
        }

        function stopScrolling() {
            clearInterval(scrollInterval);
            scrollInterval = null;
        }

        // 마우스를 올리면 스크롤 멈춤
        sproutContainer.addEventListener('mouseover', stopScrolling);
        // 마우스가 벗어나면 스크롤 다시 시작
        sproutContainer.addEventListener('mouseout', startScrolling);

        // 페이지 로드 후 스크롤 시작
        startScrolling();

    </script>
</body>
</html>